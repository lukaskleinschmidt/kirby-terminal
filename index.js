!function(){"use strict";function t(t,e,s,i,r,o,n,l){var a,h="function"==typeof t?t.options:t;if(e&&(h.render=e,h.staticRenderFns=s,h._compiled=!0),i&&(h.functional=!0),o&&(h._scopeId="data-v-"+o),n?(a=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(n)},h._ssrRegister=a):r&&(a=l?function(){r.call(this,(h.functional?this.parent:this).$root.$options.shadowRoot)}:r),a)if(h.functional){h._injectStyles=a;var u=h.render;h.render=function(t,e){return a.call(e),u(t,e)}}else{var d=h.beforeCreate;h.beforeCreate=d?[].concat(d,a):[a]}return{exports:t,options:h}}const e={};var s=t({inheritAttrs:!1,data:()=>({autoscroll:!0,error:null,isLoading:!1,options:{delay:null,dialog:null,endpoint:null,gate:null,headline:null,help:null,start:null,stop:null,theme:null},payload:{},terminal:{status:null,stdout:""},timestamp:null}),computed:{button(){return this.status?this.options.stop:this.options.start},dialog(){return this.options.dialog},gate(){return this.options.gate},headline(){return this.options.headline},help(){return this.options.help},icon(){return this.terminal.status?"loader":"circle-outline"},output(){return this.parseANSI(this.terminal.stdout)},status(){return this.terminal.status},theme(){const{theme:t}=this.options;return t?`terminal-section-${t}`:""},url(){return[this.parent,this.options.endpoint,this.name].join("/")},validates(){var t,e,s;return!!Object.keys(null!=(s=null==(e=null==(t=this.options)?void 0:t.dialog)?void 0:e.fields)?s:{}).length}},watch:{output(){var t;if(!this.autoscroll)return;const e=null!=(t=this.$refs.output)?t:null;e&&this.$nextTick((()=>{e.scrollTo(0,e.scrollHeight)}))},status(t){t&&this.poll()}},async created(){this.isLoading=!0;try{const t=await this.load();this.isLoading=!1,this.options=t.options,this.terminal=t.terminal,this.resetDialog()}catch(t){this.isLoading=!1,this.error=t}},methods:{handleError(t){this.error=t,this.terminal.status=!1},handleResponse(t){this.terminal=t},handleSubmit(){if(this.dialog&&!1===this.status)return this.$refs.dialog.open();this.submit()},parseANSI(t){const e={1:"term-bold",2:"term-faint",3:"term-italic",4:"term-underline",8:"term-conceal",9:"term-cross",30:"term-fg-black",31:"term-fg-red",32:"term-fg-green",33:"term-fg-yellow",34:"term-fg-blue",35:"term-fg-magenta",36:"term-fg-cyan",37:"term-fg-white",90:"term-fg-bright-black",91:"term-fg-bright-red",92:"term-fg-bright-green",93:"term-fg-bright-yellow",94:"term-fg-bright-blue",95:"term-fg-bright-magenta",96:"term-fg-bright-cyan",97:"term-fg-bright-white",40:"term-bg-black",41:"term-bg-red",42:"term-bg-green",43:"term-bg-yellow",44:"term-bg-blue",45:"term-bg-magenta",46:"term-bg-cyan",47:"term-bg-white",100:"term-bg-bright-black",101:"term-bg-bright-red",102:"term-bg-bright-green",103:"term-bg-bright-yellow",104:"term-bg-bright-blue",105:"term-bg-bright-magenta",106:"term-bg-bright-cyan",107:"term-bg-bright-white"},s={0:/[0-9]+/,21:/^1$/,22:/^(1|2)$/,23:/^3$/,24:/^4$/,25:/^(5|6)$/,28:/^8$/,29:/^9$/,39:/^(3|9)[0-7]$/,49:/^(4|10)[0-7]$/,54:/^(51|52)$/,55:/^53$/,65:/^6[0-4]$/};let i=[],r=!1;function o(t){t in s&&(i=i.filter((e=>!1===s[t].test(e.code))))}return t=t.replace(/\033\[([0-9;]*)([A-Za-z])/g,((t,n,l)=>{if("m"!==l)return"";for(const r of n.split(";")){const t=e[r.trim()];t?([39,49].some((t=>{if(s[t].test(r))return o(t),!0})),i.push({value:t,code:r})):o(r)}let a="";return r&&(r=!1,a+="</span>"),i.length&&(r=!0,a+=`<span class="${i.map((t=>t.value)).join(" ")}">`),a})),r&&(t+="</span>"),t},async poll(){const t=Date.now(),e=this.timestamp-t+this.options.delay;if(e>0)return setTimeout(this.poll,e);this.timestamp=t;const s=this.$refs.output,{offsetHeight:i,scrollTop:r,scrollHeight:o}=s;this.autoscroll=i+r>o-20;const n=await this.$api.get(this.url,null,{},!0);this.handleResponse(n),!0===this.status&&this.poll()},resetDialog(){var t,e,s;for(const i of Object.keys(null!=(s=null==(e=null==(t=this.options)?void 0:t.dialog)?void 0:e.fields)?s:{}))this.payload[i]=this.options.dialog.fields[i].default},async start(){this.validates||(this.terminal.status=!0,this.terminal.stdout=""),this.timestamp=Date.now();try{const t=await this.$api.post(this.url,{action:"start",payload:this.payload});this.handleResponse(t),this.dialog&&this.$refs.dialog.close()}catch(t){this.handleError(t)}},async stop(){try{const t=await this.$api.post(this.url,{action:"stop"});this.handleResponse(t)}catch(t){this.handleError(t)}},submit(){this.dialog&&!this.validates&&this.$refs.dialog.close(),this.status?this.stop():this.start()}}},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return!0===t.gate&&!1===t.isLoading?s("section",{class:["terminal-section",t.theme]},[s("header",{staticClass:"k-section-header"},[s("k-headline",[t._v(" "+t._s(t.headline)+" ")]),t.error&&"error.terminalDialog"!==t.error.key?t._e():s("k-button-group",[s("k-button",{attrs:{icon:t.icon},on:{click:t.handleSubmit}},[t._v(t._s(t.button))])],1)],1),t.error&&"error.terminalDialog"!==t.error.key?[s("k-box",{attrs:{theme:"negative"}},[s("k-text",{attrs:{size:"small"}},[s("strong",[t._v(t._s(t.$t("error.section.notLoaded",{name:t.name}))+":")]),t._v(" "+t._s(t.error.message)+" ")])],1)]:[s("div",{staticClass:"terminal-output"},[s("pre",{ref:"output"},[s("code",{domProps:{innerHTML:t._s(t.output)}})])]),s("footer",{staticClass:"k-collection-footer"},[t.help?s("k-text",{staticClass:"k-collection-help",attrs:{theme:"help"},domProps:{innerHTML:t._s(t.help)}}):t._e()],1)],t.dialog?s("k-dialog",t._b({ref:"dialog",staticClass:"terminal-dialog",on:{submit:t.submit}},"k-dialog",t.dialog,!1),[t.dialog.text?s("k-text",{domProps:{innerHTML:t._s(t.dialog.text)}}):t._e(),t.dialog.fields?s("k-form",{attrs:{fields:t.dialog.fields},on:{submit:t.submit},model:{value:t.payload,callback:function(e){t.payload=e},expression:"payload"}}):t._e(),t.error&&"error.terminalDialog"===t.error.key?[t.error.details&&Object.keys(t.error.details).length?s("dl",{staticClass:"k-error-details"},[t._l(t.error.details,(function(e,i){return[s("dt",{key:"detail-label-"+i},[t._v(" "+t._s(e.label)+" ")]),s("dd",{key:"detail-message-"+i},["object"==typeof e.message?[s("ul",t._l(e.message,(function(e,i){return s("li",{key:i},[t._v(" "+t._s(e)+" ")])})),0)]:[t._v(" "+t._s(e.message)+" ")]],2)]}))],2):t._e()]:t._e()],2):t._e()],2):t._e()}),[],!1,i,null,null,null);function i(t){for(let s in e)this[s]=e[s]}var r=function(){return s.exports}();window.panel.plugin("lukaskleinschmidt/terminal",{sections:{terminal:r}})}();
